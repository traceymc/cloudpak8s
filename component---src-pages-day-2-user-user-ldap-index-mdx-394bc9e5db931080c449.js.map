{"version":3,"sources":["webpack:///./src/pages/day2/User/UserLdap/index.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-day-2-user-user-ldap-index-mdx-394bc9e5db931080c449.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/ibm-cloud-architecture/cloudpak8s/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`Configure LDAP Identity Provider`}</h1>\n    <p>{`We will show you how to configre the LDAP Identity Provider (LDAP authentication)\nwith an OpenShift cluster.  `}</p>\n    <h2>{`Configure LDAP TLS Certificate Authority ConfigMap and Bind Password Secret`}</h2>\n    <p>{`In our scenario, we will use the TLS for the LDAP protocol (a.k.a. LDAPS).\nWe will store the LDAP Serverâ€™s TLS certificate authority (CA) certificate in\na ConfigMap in the `}<strong parentName=\"p\">{`openshift-config`}</strong>{` namespace. The LDAP Server which we will\nuse requires LDAP bind credentials to perform searches for user accounts. The\nbind user is configured as the `}<strong parentName=\"p\">{`bindDN`}</strong>{` in the Identity Provider configuration.\nThe bind password must be stored as a secret using the `}<strong parentName=\"p\">{`bindPassword`}</strong>{` data key.   `}</p>\n    <p>{`Create a ConfigMap as follows.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin create configmap -n openshift-config <configmap_name> --from-file=ca.crt=<ca_file_name>\n`}</code></pre>\n    <p>{`Here is the command output in our environment.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin create configmap -n openshift-config opentlc-ipa-tls-ca --from-file=ca.crt=ipa-ca.crt\nconfigmap/opentlc-ipa-tls-ca created\n$ \n`}</code></pre>\n    <p>{`Then, create a secret as follows.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin create secret generic -n openshift-config <secret_name> --from-literal=bindPassword=<password>\n`}</code></pre>\n    <p>{`Here is the command output in our environment.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin create secret generic -n openshift-config opentlc-ipa-bind-password --from-literal=bindPassword='r3dh4t1!'\nsecret/opentlc-ipa-bind-password created\n$ \n`}</code></pre>\n    <h2>{`Configure LDAP Identity Provider`}</h2>\n    <p>{`Now, we have a ConfigMap and a secret for LDAP. The next step will configure\nthe identity provider. Edit the `}<strong parentName=\"p\">{`oauth-config.yaml`}</strong>{` file and add the LDAP\nidentity provider configuration. Here are several fields you would use with\nyour LDAP authentication. It really depends on your LDAP server configuration.\nThis is just an example.  `}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Field`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.attributes.email`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`User email address configured as mail`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.attributes.id`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`User identity in LDAP configured as dn`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.attributes.name`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Name attribute configured as cn`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.attributes.preferredUsername`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Preferred username configured as uid`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.bindDN`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`LDAP bind user DN for user search`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.bindPassword.name`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`OpenShift secret name configured with bind password for LDAP user search bind`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.ca.name`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`OpenShift ConfigMap name configured with ca.crt for your LDAP Server`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.insecure`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Configured for secure communication with TLS encryption`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`ldap.url`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`LDAP user search URL with base DN location for user accounts, username attribute set to uid, searching the LDAP subtree under the base DN, and filter to restrict users to only those that are member of specific group`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`name`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`Identity provider name appears on the OpenShift Web Console`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`type`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"left\"\n          }}>{`LDAP value indicates LDAP identity provider`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`Here is an example of the `}<strong parentName=\"p\">{`oauth-config.yaml`}</strong>{` file with an LDAP identity\nprovider.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`apiVersion: config.openshift.io/v1\nkind: OAuth\nmetadata:\n  name: cluster\nspec:\n  identityProviders:\n  - name: Local Password\n    mappingMethod: claim\n    type: HTPasswd\n    htpasswd:\n      fileData:\n        name: htpasswd\n  - name: OPENTLC LDAP\n    challenge: true\n    login: true\n    mappingMethod: claim\n    type: LDAP\n    ldap:\n      attributes:\n        email: [\"mail\"]\n        id: [\"dn\"]\n        name: [\"cn\"]\n        preferredUsername: [\"uid\"]\n      bindDN: \"uid=admin,cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com\"\n      bindPassword:\n        name: opentlc-ipa-bind-password\n      insecure: false\n      ca:\n        name: opentlc-ipa-tls-ca\n      url: \"ldaps://ipa.shared.example.opentlc.com:636/cn=users,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com?uid?sub?(memberOf=cn=ocp-users,cn=groups,cn=accounts,dc=shared,dc=example,dc=opentlc,dc=com)\" \n\n`}</code></pre>\n    <p>{`Once you create (or update) the yaml file, replace the OAuth configuration\nwith the LDAP settings in the `}<strong parentName=\"p\">{`oauth-config.yaml`}</strong>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin replace -f oauth-config.yaml\noauth.config.openshift.io/cluster replaced\n$ \n`}</code></pre>\n    <p>{`In our scenario, we now have both Htpasswd and LDAP for the authentication.\nSince we have not logged in with the users via LDAP authentication yet, at\nthis moment, we donâ€™t see those users with the `}<inlineCode parentName=\"p\">{`oc get users`}</inlineCode>{` command. We only\nsee users who have logged in before with the Htpasswd (Local Password) identity\nprovider. In other words, until we have logged in with those users, those users\nwonâ€™t show up.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin get users\nNAME    UID                                    FULL NAME   IDENTITIES\nalice   962fdf1e-1848-11ea-a3e1-0a580a80011d               Local Password:alice\nbob     d0d4f046-1845-11ea-a3e1-0a580a80011d               Local Password:bob\n$ \n$ oc --user=admin get identities\nNAME                   IDP NAME         IDP USER NAME   USER NAME   USER UID\nLocal Password:alice   Local Password   alice           alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob     Local Password   bob             bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\n$ \n`}</code></pre>\n    <h2>{`Test LDAP Identity Provider`}</h2>\n    <p>{`Access the OpenShift Console and you see three options for `}<strong parentName=\"p\">{`Log in withâ€¦`}</strong>{`\nas shown in below.`}</p>\n    <img {...{\n      \"src\": \"/assets/img/day2/ldap_1.png\",\n      \"alt\": \"ldap_1\"\n    }}></img>\n    <p>{`For LDAP authentication, click on `}<strong parentName=\"p\">{`OPENTLC LDAP`}</strong>{` on the list. Note that`}<br parentName=\"p\"></br>{`\n`}<strong parentName=\"p\">{`OPENTLC LDAP`}</strong>{` is configured for the\n`}<strong parentName=\"p\">{`spec.identityProviders.name`}</strong>{` in the `}<strong parentName=\"p\">{`oauth-config.yaml`}</strong>{` file in the\nprevious step. Next, we see the following page.`}</p>\n    <img {...{\n      \"src\": \"/assets/img/day2/ldap_2.png\",\n      \"alt\": \"ldap_2\"\n    }}></img>\n    <p>{`Then type the user and its password for the LDAP authentication.  `}</p>\n    <p>{`In our case, two users named `}<strong parentName=\"p\">{`andrew`}</strong>{` and `}<strong parentName=\"p\">{`karla`}</strong>{` successfully logged in\nvia LDAP authentication. Check to see if those users are listed with\nthe `}<inlineCode parentName=\"p\">{`oc`}</inlineCode>{` commands.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ oc --user=admin get users\nNAME     UID                                    FULL NAME        IDENTITIES\nalice    962fdf1e-1848-11ea-a3e1-0a580a80011d                    Local Password:alice\nandrew   b8387e3f-1a70-11ea-abd6-0a580a80019a   andrew OSEUser   OPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ\nbob      d0d4f046-1845-11ea-a3e1-0a580a80011d                    Local Password:bob\nkarla    2075f2ee-1a72-11ea-abd6-0a580a80019a   karla OSEUser    OPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t\n$ \n$ oc --user=admin get identities\nNAME                                                                                                          IDP NAME         IDP USER NAME                                                                                    USER NAME   USER UID\nLocal Password:alice                                                                                          Local Password   alice                                                                                            alice       962fdf1e-1848-11ea-a3e1-0a580a80011d\nLocal Password:bob                                                                                            Local Password   bob                                                                                              bob         d0d4f046-1845-11ea-a3e1-0a580a80011d\nOPENTLC LDAP:dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   OPENTLC LDAP     dWlkPWFuZHJldyxjbj11c2Vycyxjbj1hY2NvdW50cyxkYz1zaGFyZWQsZGM9ZXhhbXBsZSxkYz1vcGVudGxjLGRjPWNvbQ   andrew      b8387e3f-1a70-11ea-abd6-0a580a80019a\nOPENTLC LDAP:dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     OPENTLC LDAP     dWlkPWthcmxhLGNuPXVzZXJzLGNuPWFjY291bnRzLGRjPXNoYXJlZCxkYz1leGFtcGxlLGRjPW9wZW50bGMsZGM9Y29t     karla       2075f2ee-1a72-11ea-abd6-0a580a80019a\n$\n`}</code></pre>\n    <p>{`As you see above, `}<strong parentName=\"p\">{`andrew`}</strong>{` and `}<strong parentName=\"p\">{`karla`}</strong>{` are using the LDAP identity\nprovider for their authentication.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}