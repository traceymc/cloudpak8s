{"version":3,"sources":["webpack:///./src/pages/mcm/cp4mcm_nom_day2/asm_day2_vCenter/index.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"yeAMO,IAAMA,EAAe,GACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,KAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,qBAAG,mBAAGC,WAAW,KAAQ,CACrB,KAAQ,yBADT,qBAGH,iFACA,6DAA4C,kBAAIA,WAAW,KAAf,kBAA5C,kDAAyI,sBAAQA,WAAW,KAAnB,YAAzI,6KACA,oCACA,0ZAGA,uCACA,wTACA,mCACA,kJAAiI,sBAAQA,WAAW,KAAnB,QAAjI,sDACA,oDACA,8CACA,6FACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,wLAEL,gJACA,sEACA,oOAEA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,qFAEL,0dAMA,iEACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,o1BAyBL,6FACA,sCACA,8PACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,idAEL,gEAA+C,0BAAYA,WAAW,KAAvB,+CAA/C,iGACA,uDACA,+LACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,gfAoBL,iDAAgC,kBAAIA,WAAW,KAAf,0CAAhC,wDAA2J,0BAAYA,WAAW,KAAvB,sBAA3J,qDACA,6CACA,wLACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,6QAEL,kEACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,mDAEL,4CACA,oGACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,gKAEL,+DACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,urBAwBL,mKACA,gKACA,qDACA,6OACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,qnBAuBL,uDACA,gKACA,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,WAPhB,WAUI,sBAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,SACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,otBACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,qBAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,mBACP,MAAS,mBACT,IAAO,sEACP,OAAU,CAAC,2EAA4E,2EAA4E,4EAA6E,4EAA6E,4EAA6E,6EAC1Y,MAAS,oCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,UAyCA,qBAAG,mBAAGA,WAAW,KAAQ,CACrB,KAAQ,yBADT,sBAOPJ,EAAWK,gBAAiB","file":"component---src-pages-mcm-cp-4-mcm-nom-day-2-asm-day-2-v-center-index-mdx-b125cac1ba465226089f.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/ibm-cloud-architecture/cloudpak8s/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p><a parentName=\"p\" {...{\n        \"href\": \"/mcm/cp4mcm_nom_day2\"\n      }}>{`Back to NOM Day2`}</a></p>\n    <h2>{`Troubleshooting Agile Service Manager vCenter Observer.`}</h2>\n    <p>{`ASM (Agile Service Manager) provides `}<em parentName=\"p\">{`Out of the Box`}</em>{` integration to the managed system through its `}<strong parentName=\"p\">{`Observer`}</strong>{`.  One such Observer is the vCenter Observer.  The following describes an example of troubleshooting the vCenter Observer by interacting with the vCenter REST interface.`}</p>\n    <h2>{`The issue.`}</h2>\n    <p>{`ASM vCenter Observer “talk” to VMWare vCenter REST interface to get the information it needs. VCenter version 6.5 is one of the supported versions by ASM.\nOne problem with working with the REST interface based Observer is that you might not see an immediate error as you run the Observer, but nothing is displayed in ASM.\nThe following is the process of troubleshooting the Observer.`}</p>\n    <h2>{`The scenario.`}</h2>\n    <p>{`We configure the ASM vCenter Observer and provide the relevant information, including the vCenter username and password in the ASM UI.  We run the Observer through the User Interface.  It ran to completion without error.  We try to see the topology, and no vCenter topology is displayed.`}</p>\n    <h2>{`The tool.`}</h2>\n    <p>{`You can use many tools to talk to a REST interface; some tools provide a nice Graphical User Interface. This article uses `}<strong parentName=\"p\">{`CURL`}</strong>{`, as it is widely available in a Linux platform.  `}</p>\n    <h2>{`The troubleshooting Steps.`}</h2>\n    <h3>{`Check the log files.`}</h3>\n    <p>{`Checking the observer log files gives the following warning message:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`WARN   [2019-06-19 00:39:15,344] [cfd95b7e-3bc7-4006-a4a8-a73a79c71255:LAB-vCenter/VCenterHostTask] c.i.i.t.o.v.j.r.t.VCenterHostTask -  Could not obtain Host Info data via REST\n`}</code></pre>\n    <p>{`The observer job exited after encountering those WARNING, which explained why there is no vCenter information in ASM.  `}</p>\n    <h3>{`Ensure that the REST interface is available.`}</h3>\n    <p>{`First, you need to ensure that the vCenter responded to a REST API call; you can start by querying the base address.\nVCenter REST can normally be accessed via https://`}{`[hostname or ipaddress]`}{`/rest.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ curl -sik -H 'Accept:application/json' -X GET https://[vcenter-address]/rest\n`}</code></pre>\n    <p>{`The flag:\n-s (for silent), is to exclude progress meter.  This is useful for concise output.\n-i this is to include the HTTP response headers in the output. As you will see later, the response header can help in debugging.\n-k (or —insecure) allows curl to accept a self-signed SSL server connection.\n-H (or —header) for specifying the header of the query. We want a JSON formatted output.\n-X (or —request) this is where you specify your request.`}</p>\n    <p>{`The server responded with the following:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`HTTP/1.1 200 OK\nDate: Wed, 19 Jun 2019 00:56:24 GMT\nContent-Type: application/json\nTransfer-Encoding: chunked\n{\n  \"value\": {\n    \"components\": {\n      \"metadata\": {\n        \"method\": \"GET\",\n        \"href\": \"https://[vCenter Address]/rest/com/vmware/vapi/metadata/metamodel/service/operation/id:com.vmware.vapi.rest.navigation.component/id:list\"\n      },\n      \"method\": \"GET\",\n      \"href\": \"https://[vCenter Address]/rest/com/vmware/vapi/rest/navigation/component\"\n    },\n    \"resources\": {\n      \"metadata\": {\n        \"method\": \"GET\",\n        \"href\": \"https://[vCenter Address]/rest/com/vmware/vapi/metadata/metamodel/service/operation/id:com.vmware.vapi.rest.navigation.resource/id:list\"\n      },\n      \"method\": \"GET\",\n      \"href\": \"https://[vCenter Address]/rest/com/vmware/vapi/rest/navigation/resource\"\n    }\n  }\n}\n`}</code></pre>\n    <p>{`With this, we know that the Server’s REST Interface is working fine.`}</p>\n    <h3>{`The endpoint`}</h3>\n    <p>{`As we are troubleshooting an ASM discovery, we needed to know the endpoint that ASM was querying.  One way to do this is to force an error by specifying a wrong username and password, to get the following message in the log file.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ERROR  [2019-06-19 00:36:31,005] [cfd95b7e-3bc7-4006-a4a8-a73a79c71255:CSPLAB-vCenter/VCenterHostTask] c.i.i.t.o.v.j.r.t.VCenterHostTask -  Could not gain access to VMware VCenter endpoint 'https://[vcenter address]/rest/vcenter/host' - check your keyStore path in job parameter. Reason:- An VMware VCenter session-id Token could not be obtained, check if the credential are correct.Cannot deserialize instance of \\`java.lang.String\\` out of START_OBJECT token\n`}</code></pre>\n    <p>{`Just what we wanted.  The endpoint was: `}<inlineCode parentName=\"p\">{`https://[vcenter-address]/rest/vcenter/host`}</inlineCode>{`.  Checking the VMWare REST documentation and verified that indeed this was a valid endpoint.`}</p>\n    <h3>{`Verify without Authorization.`}</h3>\n    <p>{`We need to specify some user information for  Authentication/Authorization before we can query more detail.  To verify, let us try without any user information first.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ curl -sik -H 'Accept:application/json' -X GET https://[vcenter-address]/rest/vcenter/host\n\nHTTP/1.1 401 Unauthorized\nDate: Wed, 19 Jun 2019 01:05:00 GMT\nContent-Type: application/json\nTransfer-Encoding: chunked\n{\n  \"type\": \"com.vmware.vapi.std.errors.unauthenticated\",\n  \"value\": {\n    \"messages\": [\n      {\n        \"args\": [],\n        \"default_message\": \"This method requires authentication.\",\n        \"id\": \"vapi.method.authentication.required\"\n      }\n    ]\n  }\n}\n\n`}</code></pre>\n    <p>{`As expected, we received `}<em parentName=\"p\">{`“This method requires authentication.”`}</em>{` response.  Note the header. It said the same thing: `}<inlineCode parentName=\"p\">{`401 - Unauthorized`}</inlineCode>{`. As mentioned earlier, the header can be useful.`}</p>\n    <h3>{`Get the session ID.`}</h3>\n    <p>{`For vCenter, the authorization is a two steps process. First, you specify your username and password to get a Session-ID, then use the Session-ID in the query.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ curl -X POST --insecure --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'vmware-use-header-authn: test' --header 'vmware-api-session-id: null' -u 'username:password' 'https://[vcenter-address]/rest/com/vmware/cis/session'\n`}</code></pre>\n    <p>{`The server responded with the session-ID:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`{\"value\":\"d2de956a5f0e072aa546e91fcf70f3dc\"}\n`}</code></pre>\n    <h3>{`Use the Session ID`}</h3>\n    <p>{`We run the same query as in step 3, but this time, we added the session-ID.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ curl -sik -H 'Accept:application/json' -H \"vmware-api-session-id:d2de956a5f0e072aa546e91fcf70f3dc\" -X GET https://[vcenter-address]/rest/vcenter/host\n`}</code></pre>\n    <p>{`And we may get the following response.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`HTTP/1.1 500 Server Error\nDate: Wed, 19 Jun 2019 00:51:24 GMT\nContent-Type: application/json\nTransfer-Encoding: chunked\n{\n  \"type\": \"com.vmware.vapi.std.errors.internal_server_error\",\n  \"value\": {\n    \"messages\": [\n      {\n        \"args\": [\n          \"com.vmware.vapi.std.errors.Unauthorized\"\n        ],\n        \"default_message\": \"Provider method implementation threw unexpected exception: com.vmware.vapi.std.errors.Unauthorized\",\n        \"id\": \"vapi.bindings.method.impl.unexpected\"\n      },\n      {\n        \"args\": [],\n        \"default_message\": \"Not authorized to perform this operation.\",\n        \"id\": \"com.vmware.api.vcenter.unauthorized\"\n      }\n    ]\n  }\n}\n`}</code></pre>\n    <p>{`Aha! We just found out about the issue! The Session-ID and hence the username and password did not have enough privilege to run the query.`}</p>\n    <p>{`Note that, unlike the response that we got in step 3, we now have a server error response header, and the message was also different.  `}</p>\n    <h3>{`An authorized user, please.`}</h3>\n    <p>{`With the above information, we can go back to the vCenter admin. Asked for a proper credential, and rerun the query with the the authorized user, and here is the query and the response, a good and valid response:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$curl -sik -H 'Accept:application/json' -H \"vmware-api-session-id:292a717da90093ccfb46ec66e8789e65\" -X GET https://[vcenter-address]/rest/vcenter/host\nHTTP/1.1 200 OK\nDate: Wed, 19 Jun 2019 01:52:51 GMT\nContent-Type: application/json\nTransfer-Encoding: chunked\n{\n  \"value\": [\n    {\n      \"host\": \"host-151\",\n      \"name\": \"172.16.3.133\",\n      \"connection_state\": \"CONNECTED\",\n      \"power_state\": \"POWERED_ON\"\n    },\n    . . . - cut for brevity - . . .\n    {\n      \"host\": \"host-89\",\n      \"name\": \"172.16.3.124\",\n      \"connection_state\": \"CONNECTED\",\n      \"power_state\": \"POWERED_ON\"\n    }\n  ]\n}\n`}</code></pre>\n    <h3>{`Let there be an ASM topology.`}</h3>\n    <p>{`We know now that my manual query works. We can go back to ASM, rerun the vCenter Observer job, lo and behold, and display the topology.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"43.75%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVQozzWR2W7UQBRE/f9/lAeQiJB4ICLJLN73fWm31zFMkKa41YCl1kjt6zOn6lrrtmFQI37d7xhGjWmekRUlvDhCVlXQy4K4KBCmGXqZ4+yoJ8zLKrML9DTj8Xjg/2PxkgNdr1C3nYEQUHcd/DRF8g92DQJEWQ4/SZDKH5Z1g7tI8BnGEcu6Yt12WMdxGKCS48cJWjXAlo/PgYcoz2GHwd9fuSPcWIvVKGmU1ugGBaYk7HY7YH18/Ma27+alUtrYOGGIs+fh5LnIyhJOFMFNYgRiXLYt8rpGkKUoxLLrByNUNa2pzFrWzfRxHD9loBYDidM0JpYt4Nerjacvz3i5nPHuOLgEvvQbIypyxHkBRVM5owgZIDvsRZuFpwIrBEYLQn9crni1bXz6+g0vJwG6Dk6Oa95X0vc4TWjFkBUwNnu0SDf5pUs1aWg9m5jf3054+vyMd9sxkS++jzeB05yLafregCeBUYoMgq19v5m1z0Kv+k4WkBk7xw9NRG7XFSC3zntPYO0wIMwyJLJ1LoWV8TCpxUKpy1K5mEo+LNrGWHAxLJ/bJ9hPE7PxRBIQxFS0Ykr2t4ncH+LymSGIfGAbAAAAAElFTkSuQmCC')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"vCenter Topology\",\n        \"title\": \"vCenter Topology\",\n        \"src\": \"/static/7405dbffe024afc6ef6680c630e003c0/3cbba/asm_vcenter_topo.png\",\n        \"srcSet\": [\"/static/7405dbffe024afc6ef6680c630e003c0/7fc1e/asm_vcenter_topo.png 288w\", \"/static/7405dbffe024afc6ef6680c630e003c0/a5df1/asm_vcenter_topo.png 576w\", \"/static/7405dbffe024afc6ef6680c630e003c0/3cbba/asm_vcenter_topo.png 1152w\", \"/static/7405dbffe024afc6ef6680c630e003c0/0b124/asm_vcenter_topo.png 1728w\", \"/static/7405dbffe024afc6ef6680c630e003c0/4ea69/asm_vcenter_topo.png 2304w\", \"/static/7405dbffe024afc6ef6680c630e003c0/f0be2/asm_vcenter_topo.png 2392w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"/mcm/cp4mcm_nom_day2\"\n      }}>{`Back to NOM Day2`}</a></p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}